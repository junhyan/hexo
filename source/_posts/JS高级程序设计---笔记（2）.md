---
title: JS高级程序设计---笔记（2）
date: 2017-12-09
---
前面一篇已经记录到了第三章，本篇从第四章开始记录，阅读第四章：变量、作用域和内存问题，第五章：引用类型。

## 变量、作用域和内存问题

### 基本类型和引用类型
undefined、null、boolen、number和string是基本数据类型，是按值访问的。可以操作保存在变量里的实际值。
引用类型是保存在内存中的对象。
#### 动态的属性
可以为引用类型的值动态添加、改变和删除属性和方法。如：
```js
var person = new Object();
person.name = 'me'; //person.name has the real value.
```
但是对于基本类型，不能动态的为其添加属性，尽管不胡导致错误但是添加的属性回事undefined。

#### 复制变量
除了保存方式不一样之外，基本类型和引用类型在进行变量复制的时候也存在不同。
基本类型的变量在复制的时候会单独分配内存作为原来变量值的副本，在操作过程中两个变量互不影响。
当一个变量向另一个变量复制引用类型的值时，复制的是一个对象的指针，而且指针指向的内存与原来引用变量所指向的内存相同。

#### 传递参数
JS中所有的参数都是按值传递的，把函数外部的值复制给函数内部，基本类型的值的传递与基本类型变量复制一样，引用类型的值传递与引用类型的变量复制一样。传递基本类型的值时候，会把值复制到一个局部变量，传递引用变量时候，会把值在内存的地址（即指针）复制给一个局部变量。

#### 检测类型
基本数据类型的值使用typeof，但对于引用类型，typeof只能显示为object，所以需要使用instanceof,语法：
```js
result = variable instanceof constructor
```
规定所有引用类型都是object，所以在instanceof操作符检测基本类型的值时候，操作符始终返回false，因为基本类型不是对象。

### 执行环境和作用域
执行环境定义了变量或函数有权访问其他数据，决定了它们各自的行为。每个执行环境都有一个与之关联的变量对象，环境中定义的所有变量和函数都保存在这个对象中。
在web浏览器中全局执行环境被认为是window对象。所有全局变量和函数都是作为window对象的属性和方法创建的。
每个函数都有自己的执行环境。将活动对象作为变量对象，活动对象在最开始只包含一个变量，即arguments对象（在全局环境中不存在，所以可以在函数内通过该对象来进行参数的获取）。

可以通过with和try-catch语句中的catch块来延长作用域链。对于with语句来说，会将指定的对象添加到作用域链中。对于catch语句来说，会创建新的变量对象，其中包含的是被抛出的错误对象的声明。

#### 没有块级作用域
上两个例子
```js
if (true){
    var color = "red";
}

alert(color);  // "red"

for (var i=0; i&lt;10; i++){
    ...
}

alert(i); //10
```
不会向c语言中if或者for中存在块级作用域，在if或者for运行结束后在内部声明定义的变量会被销毁。在JS中，这些变量不会被销毁。
使用var声明的变量会被自动添加到最接近的执行环境中。之前也有提过，如果初始化变量时没有使用var声明，则默认被添加到全局环境。
查询标示符按照就进原则。

### 垃圾收集
JS具有自动垃圾收集机制，执行环境会负责管理代码执行过程中使用的内存。

#### 清除标记
JS最常用的GC方式就是清除标记（mark-and-sweep），垃圾收集器在运行的时候会给内存中的变量都加上标记，然后去掉当前在环境中运行的变量和被变量应用的变量的标记，没有去掉标记的被视为应该删除的变量内存。垃圾收集器对含有标记的内存部分进行清除操作。

#### 引用计数
一种不太常用的GC策略叫做引用计数，引用类型的内存在赋值给一个变量时候，记录引用次数为+1，当该部分内存的引用变量又指向了其他的内存的时候，该部分内存引用次数-1，当引用次数为0的时候在垃圾收集器运行的时候，会将其清除。

#### 管理内存
系统为了防止JS网页耗尽全部内存而导致系统崩溃，分配给浏览器的内存数量通常要比应用程序少。为了用最少的内存可以让页面获得更好的性能，内存占用优化的最佳方式就是执行的代码中只保存 必要的数据，一旦数据不再有用，最好通过将其值设为null来释放其引用，这个做法叫做---解除引用。这种做法适合大部分全局变量和全局对象属性。
解除一个值的引用并不意味着自动回收该值所占用的内存，真正的作用是让值脱离执行环境，在垃圾收集器下次运行时候对其进行回收。

## 引用类型
引用类型的值（对象）是引用类型的一个实例。在ECMAScript中，引用类型是一种数据结构，用于将数据和功能组织在一起，通常被称为类。

### Object类型
目前看到的大多数的引用类型都是Object类型的实例。创建Object实例的方式有两种：
```js
var person = new Object()； //使用new操作符

var person = {}; //使用对象字面量语法

var person = {   //也是使用对象字面量语法
    name : "xxxx"， // name 可以写成 "name"
    age : 22        //不加逗号
}
```
对象字面量语法更加受开发人员青睐，代码少，封装感，而且对象字面量也是向函数传递大量可选参数的首选方式。例子：
```js
testFunction({
    name : "xxx",
    age : 23
});
```
一般来说，对象访问属性时使用点表示法，JS也可以使用方括号表示法来访问对象的属性，功能上来看，这两种方法没有任何区别，但是使用方括号的主要优点在于，可以通过变量来访问属性。对于可能造成语法错误的的字符或关键字和保留字，可以使用方括号的方式解决。例如：
```js
var key = "xxx";
person[key]; //通过变量访问属性

person["xxx xxx"]; //带有空格的对象属性，使用方括号获取。
```

### Array类型
创建Array对象也有两种方式，第一种是使用Array构造函数，示例代码如下：
```js
var colors =  new Array();
var colors =  new Array(20);
var colors =  new Array("red", "green", "grey");
var colors =  Array("red", "green", "grey"); //省略new
```
第二种基本方式是使用数组字面量表示法：示例代码如下：
```js
var colors =  [] //空数组
var colors =  ["red", "green", "grey"];
```
数组的length属性很有特点，它不是只读的，可以通过设置这个属性，从数组的末尾移除项或者向数组添加新项。利用length属性方便在末尾添加新项。
```js
var colors =  ["red", "green", "grey"];
colors.length = 2;
alert(colors[2]); //undefined

colors[colors.length] = "white";
colors[colors.length] = "blue";
```

#### 检测数组
对于一个数组或者一个全局作用域而言，使用instanceof操作就能得到满意的结果，但如果又多个全局作用域的话可能存在不同的Array构造函数。
所有ECMAScript提供的Array.isArray()方法。用来判断引用对象是不是数组。

#### 转换方法





















### 

### 

## 面向对象的程序设计

### 

### 

### 

### 


转载请注明: http://jhyan.me/2017/12/09/JS高级程序设计---笔记（2）/
